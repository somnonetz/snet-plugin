#set ($user = $data.getSession().getAttribute("userHelper"))
#set ($nrScans = $om.getSortedScans().size())
#set ($nrRecords = $user.getQueryResultsAsArrayList("SELECT * FROM snet01_psgscandata_record").size()) 
#set ($recordCount = $scanCounter+$nrScans)
#set ($imageScanId = $scan.getProperty("xnat_imagescandata_id"))
#set ($imageSessionId = $scan.getProperty("image_session_id"))
#set ($label = $scan.getProperty("id"))
#set ($query = "SELECT channelnumber, label, samplingrate, transducertype, physicaldimension, physicalminimum, physicalmaximum, digitalminimum, digitalmaximum, prefiltering, samplesinrecord FROM snet01_psgscandata_record WHERE records_record_snet01_psgscanda_xnat_imagescandata_id = $imageScanId ORDER BY channelnumber")
#set ($records = $user.getQueryResultsAsArrayList($query))

<button onClick="window.open(`${window.origin}/sn-editor?edf=${window.origin}${serverRoot}` + '/data/experiments/' + '$imageSessionId' + '/scans/$label/resources/EDF/files/' + '$label' + '.edf')">View EDF file</button>

<h1> EDF Headers </h1>

<table>
	#if($scan.getProperty("quality"))
	<tr>
		<td></td>
		<td>Quality</td>
		<td align="left">$!scan.getProperty("quality")</td>
	</tr>
	#end
	#if($scan.getProperty("psgdevice"))
	<tr>
		<td></td>
		<td>PSG-Model</td>
		<td align="left">$!scan.getProperty("psgdevice")</td>
	</tr>
	#end
	#if($scan.getProperty("recordingstartdate"))
	<tr>
		<td></td>
		<td>Recording Start Date</td>
		<td align="left">$!scan.getProperty("recordingstartdate")</td>
	</tr>
	#end
	#if($scan.getProperty("recordingstarttime"))
	<tr>
		<td></td>
		<td>Recording Start Time</td>
		<td align="left">$!scan.getProperty("recordingstarttime")</td>
	</tr>
	#end
	#if($scan.getProperty("durationofrecordhours"))
	<tr>
		<td></td>
		<td>Duration of Record (hours)</td>
		<td align="left">$!scan.getProperty("durationofrecordhours")</td>
	</tr>
	#end
	#if($scan.getProperty("numberofsignalsindatarecord"))
	<tr>
		<td></td>
		<td>Number of Channels</td>
		<td align="left">$!scan.getProperty("numberofsignalsindatarecord")</td>
	</tr>	
	#end
</table>

<h2>Channel Headers</h2>

<table style="border-bottom:0">	
	<tr>
		<td><strong>Channel</strong></td>
		<td><strong>Label</strong></td>
		<td><strong>Samplingrate [Hz]</strong></td>
		<td><strong>Transducer Type</strong></td>
		<td><strong>Physical Dimension</strong></td>
		<td><strong>Physical Minimum</strong></td>
		<td><strong>Physical Maximum</strong></td>
		<td><strong>Digital Minimum</strong></td>
		<td><strong>Digital Maximum</strong></td>
		<td><strong>Prefiltering</strong></td>
		<td><strong>Samples in Record</strong></td>
	</tr>	
	#foreach($record in $records)
		<tr>
			<td>
				#if($record.get(0))
					$record.get(0)
				#end
			</td>
			<td>
				#if($record.get(1))
					$record.get(1)
				#end
			</td>
			<td>
				#if($record.get(2))
					$record.get(2)
				#end
			</td>
			<td>
				#if($record.get(3))
					$record.get(3)
				#end
			</td>
			<td>
				#if($record.get(4))
					$record.get(4)
				#end
			</td>
			<td>
				#if($record.get(5))
					$record.get(5)
				#end
			</td>
			<td>
				#if($record.get(6))
					$record.get(6)
				#end
			</td>
			<td>
				#if($record.get(7))
					$record.get(7)
				#end
			</td>
			<td>
				#if($record.get(8))
					$record.get(8)
				#end
			</td>
			<td>
				#if($record.get(9))
					$record.get(9)
				#end
			</td>
			<td>
				#if($record.get(10))
					$record.get(10)
				#end
			</td>
		</tr>	
	#end
</table>
